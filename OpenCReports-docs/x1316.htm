<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Data source related functions</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="OpenCReports Manual"
HREF="book1.htm"><LINK
REL="UP"
TITLE="C language API reference"
HREF="c1183.htm"><LINK
REL="PREVIOUS"
TITLE="Low level C API"
HREF="x1224.htm"><LINK
REL="NEXT"
TITLE="Query related functions"
HREF="x1347.htm"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>OpenCReports Manual</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x1224.htm"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 6. C language API reference</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x1347.htm"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="AEN1316"
>Data source related functions</A
></H1
><P
>&#13;			The following <TT
CLASS="literal"
>enum</TT
> and <TT
CLASS="literal"
>struct</TT
>
			types are used by OpenCReports.
			<PRE
CLASS="programlisting"
>&#13;enum ocrpt_result_type {
    OCRPT_RESULT_ERROR,
    OCRPT_RESULT_STRING,
    OCRPT_RESULT_NUMBER,
    OCRPT_RESULT_DATETIME
};

struct ocrpt_string {
    char *str;
    size_t allocated_len;
    size_t len;
};
typedef struct ocrpt_string ocrpt_string;

struct ocrpt_result {
    enum ocrpt_result_type type;
    ocrpt_string *string;
    mpfr_t number;
    bool number_initialized;
    bool string_owned;
    bool isnull;
    struct tm datetime;
};
typedef struct ocrpt_result ocrpt_result;

struct ocrpt_query_result {
    const char *name;
    bool name_allocated;
    ocrpt_result result;
};
typedef struct ocrpt_query_result ocrpt_query_result;

struct ocrpt_input {
    void (*describe)(ocrpt_query *, ocrpt_query_result **, int32_t *);
    void (*rewind)(ocrpt_query *);
    bool (*next)(ocrpt_query *);
    bool (*populate_result)(ocrpt_query *);
    bool (*isdone)(ocrpt_query *);
    void (*free)(ocrpt_query *);
};
typedef struct ocrpt_input ocrpt_input;
			</PRE
>
		</P
><P
>&#13;			Data source handling is implemented via <TT
CLASS="literal"
>ocrpt_input</TT
>
			functions.
		</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1324"
><TT
CLASS="literal"
>ocrpt_add_datasource</TT
></A
></H2
><P
>&#13;				Add a (custom) data source to the report handler.
				<PRE
CLASS="programlisting"
>&#13;ocrpt_datasource *ocrpt_add_datasource(opencreport *o,
                                       const char *source_name,
                                       const ocrpt_input *input);
				</PRE
>
			</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1329"
><TT
CLASS="literal"
>ocrpt_datasource_get</TT
></A
></H2
><P
>&#13;				Find the data source using its name. It returns NULL
				if the named data source is not found.
				<PRE
CLASS="programlisting"
>&#13;ocrpt_datasource *ocrpt_datasource_get(opencreport *o,
                                        const char *source_name);
				</PRE
>
			</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1334"
><TT
CLASS="literal"
>ocrpt_validate_datasource</TT
></A
></H2
><P
>&#13;				Check that the provided <TT
CLASS="literal"
>source</TT
> pointer
				is valid for the <TT
CLASS="literal"
>o</TT
> report handler.
				<PRE
CLASS="programlisting"
>&#13;ocrpt_datasource *ocrpt_validate_datasource(opencreport *o,
                                            ocrpt_datasource *source);
				</PRE
>
			</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1341"
><TT
CLASS="literal"
>ocrpt_add_array_datasource</TT
></A
></H2
><P
>&#13;				Add a named array data source. It is optional, as a array
				data source called <TT
CLASS="literal"
>array</TT
> is added to the
				report handler implicitly.
				<PRE
CLASS="programlisting"
>&#13;ocrpt_datasource *ocrpt_add_array_datasource(opencreport *o,
                                             const char *source_name);
				</PRE
>
			</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x1224.htm"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.htm"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x1347.htm"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Low level C API</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c1183.htm"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Query related functions</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>