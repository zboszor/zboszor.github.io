<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Low level C API</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="OpenCReports Manual"
HREF="book1.html"><LINK
REL="UP"
TITLE="C language API reference"
HREF="c1730.html"><LINK
REL="PREVIOUS"
TITLE="High level C API"
HREF="x1736.html"><LINK
REL="NEXT"
TITLE="Data source related functions"
HREF="x1863.html"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>OpenCReports Manual</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x1736.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>C language API reference</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x1863.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="lowlevelapi"
>Low level C API</A
></H1
><P
>&#13;			The <A
HREF="x1736.html"
>High level C API</A
> is also part of the
			low level API. The functions described below allow
			creating a report using program code, or simply
			fine tuning the report behavior by mostly using the
			<A
HREF="x1736.html"
>High level C API</A
>.
		</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="numerictuning"
>Numeric behavior related functions</A
></H2
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1778"
><TT
CLASS="literal"
>Set numeric precision</TT
></A
></H3
><P
>&#13;					The default is 256 bits of floating point precision.
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;void ocrpt_set_numeric_precision_bits(opencreport *o,
                                      mpfr_prec_t prec);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1783"
>Set rounding mode</A
></H3
><P
>&#13;					OpenCReports uses GNU MPFR under the hood and does't
					hide this fact. The MPFR rounding mode constants are
					used as is to set the rounding behaviour.
					The default is <TT
CLASS="literal"
>MPFR_RNDN</TT
>, round
					to nearest.
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;void ocrpt_set_rounding_mode(opencreport *o,
                             mpfr_rnd_t rndmode);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1788"
>Locale related functions</A
></H2
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1790"
>Set report locale</A
></H3
><P
>&#13;					Setting the locale for the report does not affect
					the main program or other threads. Locale setting
					includes the language, the country. The UTF-8 suffix
					is necessary. E.g.: <TT
CLASS="literal"
>en_GB.UTF-8</TT
> or
					<TT
CLASS="literal"
>de_DE.UTF-8</TT
>
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;void ocrpt_set_locale(opencreport *o,
                      const char *locale);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1796"
>Print monetary data in the report locale</A
></H3
><P
>&#13;					A customized monetary printing function was implemented
					for the purposes of the report which MPFR doesn't
					provide. It is used in OpenCReports both internally
					and by unit tests.
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;ssize_t ocrpt_mpfr_strfmon(opencreport *o,
                           char *s, size_t maxsize,
                           const char *format, ...);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="exprfunc"
>Expression related functions</A
></H2
><P
>&#13;				Expressions in OpenCReports is explained in the
				<A
HREF="c1038.html"
>Expressions</A
> chapter.
			</P
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1804"
>Parse an expression string</A
></H3
><P
>&#13;					This function parses an expression string and
					creates an expression tree. It returns a pointer
					to the <TT
CLASS="literal"
>ocrpt_expr</TT
> structure.
				</P
><P
>&#13;					If an error occurs, it returns NULL and optionally
					returns the error message in <TT
CLASS="literal"
>err</TT
>
					pointer if it's not <TT
CLASS="literal"
>NULL</TT
>.
				</P
><P
>&#13;					The <TT
CLASS="literal"
>ocrpt_report</TT
> pointer may be
					valid or NULL. If valid, the expression is bound
					to this <TT
CLASS="literal"
>ocrpt_report</TT
>.
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;ocrpt_expr *ocrpt_expr_parse(opencreport *o,
                             ocrpt_report *r,
                             const char *str,
                             char **err);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1815"
>Free an expression parse tree</A
></H3
><P
>&#13;					Free an expression parse tree. If it was bound
					to the passed-in <TT
CLASS="literal"
>ocrpt_report</TT
>,
					this association is also deleted.
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;void ocrpt_expr_free(opencreport *o,
                     ocrpt_report *r,
                     ocrpt_expr *e);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1820"
>Resolve expression references</A
></H3
><P
>&#13;					This function resolves variable (identifier)
					references in the expression. This is needed
					to bind query columns to expressions that
					use them.
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;void ocrpt_expr_resolve(opencreport *o,
                        ocrpt_report *r,
                        ocrpt_expr *e);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1824"
>Optimize an expression</A
></H3
><P
>&#13;					This function optimizes an expression so
					it may needs fewer computation steps during
					report execution.
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;void ocrpt_expr_optimize(opencreport *o,
                         ocrpt_report *r,
                         ocrpt_expr *e);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1828"
>Evaluate an expression</A
></H3
><P
>&#13;					This function evaluates the expression.
					It returns the expression's
					<TT
CLASS="literal"
>ocrpt_result</TT
> result structure.
					The result must not be freed with
					<TT
CLASS="literal"
>ocrpt_result_free()</TT
>.
					It will be done by <TT
CLASS="literal"
>ocrpt_expr_free()</TT
>
				</P
><P
>&#13;					For expressions with query column references,
					this function must be called after
					<TT
CLASS="literal"
>ocrpt_query_navigate_next</TT
>
					otherwise the result is not valid.
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;ocrpt_result *ocrpt_expr_eval(opencreport *o,
                              ocrpt_report *r,
                              ocrpt_expr *e);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1837"
>Get expression result without evaluation</A
></H3
><P
>&#13;					This function returns the expression result
					if it was already evaluated.
					The result must not be freed with
					<TT
CLASS="literal"
>ocrpt_result_free()</TT
>.
					It will be done by <TT
CLASS="literal"
>ocrpt_expr_free()</TT
>.
					Used by unit tests.
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;ocrpt_result *ocrpt_expr_get_result(opencreport *o,
                                    ocrpt_expr *e);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1843"
>Print an expression tree</A
></H3
><P
>&#13;					Print an expression tree in its processed form on the
					standard output. Used by unit tests.
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;void ocrpt_expr_print(opencreport *o,
                      ocrpt_expr *e);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1847"
>Print an expression tree with subexpressions and their results</A
></H3
><P
>&#13;					Print an expression tree with subexpressions
					and their results in its processed form on the
					standard output. Used by unit tests.
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;void ocrpt_expr_result_deep_print(opencreport *o,
                                  ocrpt_expr *e);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1851"
>Count the number of expression nodes</A
></H3
><P
>&#13;					This function returns the number of expression nodes.
					Used by unit tests to validate optimizazion.
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;int32_t ocrpt_expr_nodes(ocrpt_expr *e);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1855"
>Initialize expression result type</A
></H3
><P
>&#13;					OpenCReports keeps track of the last three query
					rows and computes three result values for expressions
					for internal reasons. These functions initialize
					the type for either the current result or all results
					of the expression.
					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;enum ocrpt_result_type {
    OCRPT_RESULT_ERROR,
    OCRPT_RESULT_STRING,
    OCRPT_RESULT_NUMBER,
    OCRPT_RESULT_DATETIME
};

bool ocrpt_expr_init_result(opencreport *o,
                            ocrpt_expr *e,
                            enum ocrpt_result_type type);

void ocrpt_expr_init_results(opencreport *o,
                             ocrpt_expr *e,
                             enum ocrpt_result_type type);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1859"
>Set an error string as expression result</A
></H3
><P
>&#13;					<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;ocrpt_result *
ocrpt_expr_make_error_result(opencreport *o,
                             ocrpt_expr *e,
                             const char *format, ...);
					</PRE
></TD
></TR
></TABLE
>
				</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x1736.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x1863.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>High level C API</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c1730.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Data source related functions</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>